import numpy as np
import cv2

image = cv2.VideoCapture("C0520.MP4")
fgbg = cv2.createBackgroundSubtractorMOG2()
x1,y1=750,650
k=0
while True:
    k+=1
    ret, frame=image.read()
    if ret==False:
        break
    print(k)
    kozak = frame[y1:y1 + 250, x1:x1 + 250]
    fgmask=fgbg.apply(kozak)
    output1=cv2.bitwise_and(kozak,kozak,mask=fgmask)
    #ORANGE
    color=cv2.cvtColor(output1,cv2.COLOR_RGB2HSV)
    mask=cv2.inRange(color,np.array([96,84,170]),np.array([255,255,255]))
    mask2 =cv2.erode(mask,kernel=None,iterations=1)
    mask3 = cv2.dilate(mask2,kernel=None,dst=None,iterations=8)
    output=cv2.bitwise_and(kozak,kozak,mask=mask3)
    #WHITE
    mask11=cv2.inRange(output1,np.array([195,195,200]),np.array([255,255,255]))
    mask21 =cv2.erode(mask11,kernel=None,iterations=1)
    mask31 = cv2.dilate(mask21,kernel=None,dst=None,iterations=8)
    output2=cv2.bitwise_and(kozak,kozak,mask=mask31)

    try:
        kupa1, kupa2 = cv2.findContours(mask31, mode=cv2.RETR_CCOMP, method=cv2.CHAIN_APPROX_SIMPLE)
        for i in kupa1:
            epsilon = 0.001 * cv2.arcLength(i, True)
            approx = cv2.approxPolyDP(i, epsilon, True)
            x, y, w, h = cv2.boundingRect(approx)
            rect = cv2.minAreaRect(approx)
            box2 = cv2.boxPoints(rect)
            box2 = np.int0(box2)

            for i in range(len(box2)):
                box2[i][0]+=x1
                box2[i][1]+=y1

            cv2.drawContours(frame, [box2], 0, (255,255,255), 2)


    except:
        print('Nie wykryto piłeczek')

    try:
        kupa1, kupa2 = cv2.findContours(mask3, mode=cv2.RETR_CCOMP, method=cv2.CHAIN_APPROX_SIMPLE)
        for i in kupa1:

            epsilon = 0.001 * cv2.arcLength(i, True)
            approx = cv2.approxPolyDP(i, epsilon, True)
            x, y, w, h = cv2.boundingRect(approx)
            rect = cv2.minAreaRect(approx)
            box = cv2.boxPoints(rect)
            box = np.int0(box)

            for i in range(len(box)):
                box[i][0] += x1
                box[i][1] += y1

            print(box)
            cv2.drawContours(frame, [box], 0, (0, 0, 0), 2)



    except:
        print('Nie wykryto piłeczek')



    if k>50 and box[0][0]>126and box[0][1]>126:
        x1=box[0][0]-125
        y1=box[0][1]-125


    if cv2.waitKey(5) & 0xFF ==ord('q'):
        break
    cv2.imshow("frame",frame)
    cv2.imshow("ijfoia",output2)
    kupa1=[]
